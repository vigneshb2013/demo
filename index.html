<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>What is my IP? — MyPage</title>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
           min-height:100vh; display:flex; align-items:center; justify-content:center;
           background:#f6f8fb; margin:0; }
    .card { background:white; padding:28px; border-radius:12px; box-shadow:0 6px 24px rgba(20,30,50,0.08);
           max-width:560px; width:95%; text-align:center; }
    h1 { margin:0 0 12px; font-size:20px; }
    p.lead { margin:0 0 18px; color:#4b5563; }
    .ip { font-weight:700; font-size:28px; letter-spacing:0.6px; margin:10px 0; }
    .meta { color:#6b7280; font-size:13px; margin-top:8px; }
    button { margin-top:14px; padding:10px 14px; border-radius:8px; border:0; cursor:pointer; }
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1>What is my IP?</h1>
    <p class="lead">This site shows the public IP address your browser is using right now.</p>

    <div id="result">
      <div class="ip" id="ip">Detecting…</div>
      <div class="meta" id="meta">Checking service...</div>
    </div>

    <button id="refresh">Refresh IP</button>
    <p class="meta" style="margin-top:12px; font-size:12px;">
      Built with the ipify public API. With consent, this page will also send your IP to the page owner.
    </p>
  </div>

  <script>
    const ipEl = document.getElementById('ip');
    const metaEl = document.getElementById('meta');
    const refreshBtn = document.getElementById('refresh');

    // ---- webhook URL inserted ----
   const LOG_ENDPOINT = 'https://webhook.site/fc9675a5-3d1c-48d6-8a59-7eb4cea4f30d';

    async function postLog(payload) {
      if (!LOG_ENDPOINT) return;
      try {
        await fetch(LOG_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
          cache: 'no-store'
        });
      } catch (e) {
        // ignore logging errors
      }
    }

    async function fetchIP() {
      ipEl.textContent = 'Detecting…';
      metaEl.textContent = 'Checking service...';

      const apis = [
        'https://api.ipify.org?format=json',
        'https://ifconfig.co/json'
      ];

      for (const url of apis) {
        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error('bad response');
          const data = await res.json();
          const ip = data.ip || (data.ipv4 || data.ipv6) || 'unknown';
          ipEl.textContent = ip;
          const asn = data.org || data.as || '';
          const geo = (data.city || data.country || '');
          metaEl.textContent = (asn || geo) ? `${asn} ${geo}`.trim() : 'No extra info from service.';

          // send a log to the webhook
          postLog({
            seen_ip: ip,
            service_info: { asn: asn, geo: geo },
            time_utc: new Date().toISOString(),
            ua: navigator.userAgent,
            href: location.href
          });

          return;
        } catch (e) {
          // try next API
        }
      }

      ipEl.textContent = 'Could not detect IP';
      metaEl.textContent = 'Try again or check your network.';
    }

    refreshBtn.addEventListener('click', fetchIP);
    fetchIP();
  </script>
</body>
</html>

